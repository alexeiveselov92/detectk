# Custom Message Template Example
#
# This example shows how to customize alert messages using Jinja2 templates
#
# Use cases:
# - Different language (Russian, German, etc.)
# - Minimal format for frequent alerts
# - Include dashboard/log links
# - Different format for different detectors

name: "sessions_custom_alert"
description: "Example with custom Russian alert template"

collector:
  type: "clickhouse"
  params:
    host: "${CLICKHOUSE_HOST:-localhost}"
    port: 9000
    database: "analytics"
    query: |
      SELECT count() as value
      FROM sessions
      WHERE timestamp >= now() - INTERVAL 10 MINUTE

detector:
  type: "mad"
  params:
    window_size: "30 days"
    n_sigma: 3.0
    use_weighted: true

alerter:
  type: "mattermost"
  params:
    webhook_url: "${MATTERMOST_WEBHOOK}"
    cooldown_minutes: 60

    # Custom message template (Jinja2)
    message_template: |
      üö® **–ê–ù–û–ú–ê–õ–ò–Ø –û–ë–ù–ê–†–£–ñ–ï–ù–ê** `{{ metric_name }}`

      üìä **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ value | round(2) }}
      {% if direction %}
      üìà **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** {{ direction }}
      {% endif %}
      {% if lower_bound and upper_bound %}
      üìâ **–û–∂–∏–¥–∞–µ–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω:** [{{ lower_bound | round(2) }} - {{ upper_bound | round(2) }}]
      {% endif %}
      {% if score %}
      ‚ö†Ô∏è **–û—Ü–µ–Ω–∫–∞ –∞–Ω–æ–º–∞–ª–∏–∏:** {{ score | round(2) }} —Å–∏–≥–º
      {% endif %}
      {% if percent_deviation %}
      üìè **–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:** {{ percent_deviation | round(1) }}%
      {% endif %}

      üïí **–í—Ä–µ–º—è:** {{ timestamp.strftime('%d.%m.%Y %H:%M:%S') }}

      {% if metadata.detector %}
      üîç **–î–µ—Ç–µ–∫—Ç–æ—Ä:** {{ metadata.detector }}
      {% if metadata.window_size %}(–æ–∫–Ω–æ: {{ metadata.window_size }}){% endif %}
      {% if metadata.n_sigma %}(–ø–æ—Ä–æ–≥: {{ metadata.n_sigma }} —Å–∏–≥–º){% endif %}
      {% endif %}

      [üìä –û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥](https://grafana.example.com/d/sessions)

storage:
  enabled: true
  type: "clickhouse"
  params:
    host: "${CLICKHOUSE_HOST:-localhost}"
    database: "detectk"
